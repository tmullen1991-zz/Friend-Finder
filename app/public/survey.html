<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <title>Survey</title>
  </head>

  <body>
    <div class="container">
      <div class="row z-depth-5">
        <div class="col s1"></div>
        <div class="col s10"></div>
        <h2>
          Survey Questions: answer with numbers 1-5 (1 dislike, 5 like the most)
        </h2>
        <div class="row z-depth-5" style="padding: 20px;">
          <div class="input-field col s10">
            <input placeholder="Name" id="name" type="text" class="validate" />
            <label for="name">Name</label>
          </div>

          <div class="input-field col s10">
            <input
              placeholder="Link to Photo"
              id="photo"
              type="text"
              class="validate"
            />
            <label for="photo">Link</label>
          </div>

          <div class="questions">
            <div class="col s12">
              <h4>Question 1</h4>
              <h6>Do you like dogs?</h6>
              <div class="input-field col s12">
                <select id="question1">
                  <option value="1">1 (Strongly Disagree)</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5 (Strongly Agree)</option>
                </select>
                <label>Select Answer</label>
              </div>
              <div class="divider"></div>
            </div>

            <div class="col s12">
              <h4>Question 2</h4>
              <h6>Do you like cats?</h6>
              <div class="input-field col s12">
                <select id="question2">
                  <option value="1">1 (Strongly Disagree)</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5 (Strongly Agree)</option>
                </select>
                <label>Select Answer</label>
              </div>
              <div class="col s12">
                <h4>Question 3</h4>
                <h6>Do you dislike pets?</h6>
                <div class="input-field col s12">
                  <select id="question3">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 4</h4>
                <h6>Do you like hot chocolate?</h6>
                <div class="input-field col s12">
                  <select id="question4">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 5</h4>
                <h6>Is Netflix and chill your go-to on an average night?</h6>
                <div class="input-field col s12">
                  <select id="question5">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 6</h4>
                <h6>Do you get bored easy?</h6>
                <div class="input-field col s12">
                  <select id="question6">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 7</h4>
                <h6>
                  Do you procrastinate on any site or phone app way to much?
                </h6>
                <div class="input-field col s12">
                  <select id="question7">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 8</h4>
                <h6>
                  Do you enjoy movies in home or theater?(1 home, 5 theater, 3
                  neutral)
                </h6>
                <div class="input-field col s12">
                  <select id="question8">
                    <option value="1">1 (home)</option>
                    <option value="2">2</option>
                    <option value="3">3(neutral)</option>
                    <option value="4">4</option>
                    <option value="5">5 (theater)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 9</h4>
                <h6>Do you enjoy exercising?</h6>
                <div class="input-field col s12">
                  <select id="question9">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <div class="col s12">
                <h4>Question 10</h4>
                <h6>Do you hate surveys like this on Facebook?</h6>
                <div class="input-field col s12">
                  <select id="question10">
                    <option value="1">1 (Strongly Disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (Strongly Agree)</option>
                  </select>
                  <label>Select Answer</label>
                </div>
                <div class="divider"></div>
              </div>
              <a
                id="submit"
                class="grey waves-effect waves-light btn modal-trigger"
                href="#modal1"
                >Submit</a
              >

              <div id="modal1" class="modal">
                <div class="modal-content">
                  <h3>Friend Mathched! :D</h3>
                  <h5 id="match-name"></h5>
                  <img id="match-photo" src="" />
                  <h6 id="match-scores"></h6>
                </div>
                <div class="modal-footer">
                  <a
                    href="#!"
                    class="modal-close waves-effect waves-green btn-flat"
                    >Close</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col s1"></div>
      </div>
    </div>
  </body>

  <script type="text/javascript">
    $(document).ready(function() {
      //materialize jquery calls
      $("select").formSelect();
      $(".modal").modal();
      // click event
      $("#submit").on("click", function(event) {
        event.preventDefault();
        var scores = [];
        for (i = 1; i <= 10; i++) {
          scores.push($("#question" + i).val());
        }
        var newFriend = {
          name: $("#name").val(),
          photo: $("#photo").val(),
          scores: scores
        };

        $.post("/api/friends", newFriend, function(data) {
          if (data) {
            $.ajax({ url: "/api/friends", method: "GET" }).then(function(
              friends
            ) {
              // an array for storing the total difference in scores that will be stored in the same index position as the current friend value in the for loop below
              var differences = [];
              var match;
              // loop through each friend stored
              for (i = 0; i < friends.length; i++) {
                // if not the users data then compare with next for loop
                if (friends[i].name !== newFriend.name) {
                  var friendDifference = 0;
                  // loop through scores to tally total difference
                  for (j = 0; j < friends[i].scores.length; j++) {
                    friendDifference +=
                      friends[i].scores[j] - newFriend.scores[j];
                  }
                  // push the total difference into the array
                  differences.push(friendDifference);
                }
                // if the total difference by the end on the first for loop is lowest, make match the corresponding friend
                for (k = 0; k < differences.length; k++) {
                  if (differences[0] >= differences[k]) {
                    match = friends[k];
                  }
                }
              }
              $("#match-name").append(match.name);
              $("#match-photo").attr("src", match.photo);
              $("#match-scores").append("scores: " + match.scores.join(", "));
            });
          } else {
            alert("something went wrong");
          }
        });
      });
    });
  </script>
</html>
